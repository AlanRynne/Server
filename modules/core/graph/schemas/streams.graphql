extend type Query @hasScope(scope: "streams:read") {
  """
  Gets a specific stream.
  """
  stream( id: String! ): Stream @isAuthorizedForStream(role: "stream:reviewer")

  """
  All the streams of the current user, pass in the `query` parameter to seach by name, description or ID.
  """
  streams( query: String!, limit: Int! = 25, cursor: String ): StreamCollection
}

type Stream {
  id: String!
  name: String!
  description: String
  isPublic: Boolean!
  createdAt: String!
  updatedAt: String!
  collaborators: [ StreamCollaborator ]!
}

extend type User {
  """
  All the streams that a user has access to.
  """
  streams( limit: Int! = 25, cursor: String ): StreamCollection
}

type StreamCollaborator {
  id: String!
  name: String!
  role: String!
}

type StreamCollection {
  totalCount: Int!
  cursor: String
  items: [ Stream ]
}


extend type Mutation @hasRole(role: "server:user") @hasScope(scope: "streams:write")
{
  """
  Creates a new stream.
  """
  streamCreate( stream: StreamCreateInput! ): String
  """
  Updates an existing stream.
  """
  streamUpdate( stream: StreamUpdateInput! ): Boolean! @isAuthorizedForStream(role: "stream:owner")

  """
  Deletes an existing stream.
  """
  streamDelete( id: String! ): Boolean! @isAuthorizedForStream(role: "stream:owner")

  """
  Grants permissions to a user on a given stream.
  """
  streamGrantPermission( streamId: String!, userId: String!, role: String! ): Boolean @isAuthorizedForStream(role: "stream:owner")

  """
  Revokes the permissions of a user on a given stream.
  """
  streamRevokePermission( streamId: String!, userId: String! ): Boolean @isAuthorizedForStream(role: "stream:owner")
}

extend type Subscription {

  #
  # User bound subscriptions that operate on the stream collection of an user
  # Example relevant view/usecase: a given user's profile page.
  #

  # Source:
  # - stream created mutation (target: stream creator)
  # - stream grant permissions (target: grantee id)
  #
  # Payload: maybe just the streamId? as this event will trigger a new call to get the user's streams on the client side?
  # 
  # TODO: scope check: if context.userId === variables.userId -> profile:read; otherwise users:read
  # Q: make the arg optional; if not present -> default to context.user?
  """
  Subscribes to new stream created event for a given user.
  """
  userStreamCreated( ownerId: String! ): JSONObject @hasRole(role: "server:user") @hasScope(scope: "profile:read")

  # Source:
  # - stream delete mutation (target: all stream users in acl)
  # - stream revoke permissions (target: grantee id)
  #
  # Payload: maybe just the streamId? as this event will trigger a new call to get the user's streams on the client side?
  """
  Subscribes to stream deleted event for a given user.
  """
  userStreamDeleted( ownerId: String! ): String! @isAuthorizedForStream(role: "stream:reviewer") @hasScope(scope: "profile:read")

  #
  # Stream bound subscriptions that operate on a specific stream.
  # Relevant views/usecase: a specific stream connector client; updates the name, etc.
  # 

  # Source:
  # - stream update mutation (target: streamId )
  """
  Subscribes to stream updated event.
  """
  streamUpdated( streamId: String! ): JSONObject @isAuthorizedForStream(role: "stream:reviewer")

  # Source:
  # - stream delete mutation (target: streamId )
  # 
  # Payload: maybe just the streamId? as this event will trigger a new call to get the user's streams on the client side?
  """
  Subscribes to stream delete event.
  """
  streamDeleted( streamId: String! ): String! @isAuthorizedForStream(role: "stream:reviewer")
}

input StreamCreateInput {
  name: String
  description: String
  isPublic: Boolean
}

input StreamUpdateInput {
  id: String!
  name: String
  description: String
  isPublic: Boolean
}
